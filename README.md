- The `server_AServer.py` contains the `Aserver` class, that is the auxiliary server of Phase II. 
- `fedft.py` contains aggregation algorithms in Phase III.



# Non-IID data

There are six datasets located in the `dataset/word_generate` directory. These datasets have **different numbers** of clients, and each client has a unique word associated with it. The unique words across all six datasets are **not shared**, meaning that each dataset has its own set of unique words.

The frequency of each dataset's unique words follows the Zipf distribution, which is a power-law probability distribution that models the occurrence of words in natural languages.

|No. Total client| No. Unique Words|
|----|----|
|2000| 726|
|3500| 1052|
|5000| 1256|
|6500| 1498|
|8000| 1643|
|9500| 1778|


# Experiment on Non-IID

## Intra-cluster Experiments
```
Settings: 20 runs to get the average accuracy
 
 PEM  vs. GTF (w. group_size fitting) vs. XTU (w. GRRX) vs. XTF (FedFT, w. group_size fitting, GRRX) vs. TrieHH

```
### 1. No. Clients 2000
Top 5 frequent words with count: [('smog', 244), ('pianist', 103), ('powder', 70), ('hiccups', 51), ('city', 48)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.0 | 0.145 | 0.21 | 0.31 | 0.375 | 0.405 | 0.45 | 0.36 | 0.415 |
| GTF | recall | 0.0 | 0.005 | 0.14 | 0.215 | 0.31 | 0.385 | 0.405 | 0.455 | 0.455 | 0.435 |
| XTU | recall | 0.0 | 0.02 | 0.195 | 0.465 | 0.615 | 0.645 | 0.655 | 0.685 | 0.65 | 0.675 |
| XTF | recall | 0.0 | 0.015 | 0.215 | 0.46 | 0.76 | 0.765 | 0.81 | 0.775 | 0.8 | 0.79 |
| TrieHH |recall|  0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |Â 
| PEM |  F1  |0.0|0.005|0.134|0.293|0.4|0.53|0.548|0.586|0.515|0.563|
| GTF |  F1  | 0.0|0.01|0.113|0.255|0.386|0.5|0.552|0.569|0.604|0.589|
| XTU |  F1  |0.0|0.01|0.185|0.46|0.635|0.68|0.655|0.685|0.645|0.675|
| XTF |  F1  |0.0|0.02|0.205|0.49|0.725|0.785|0.8|0.775|0.795|0.785|
|TrieHH|  F1 |0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|
### 2. No. Clients 3500

Top 5 frequent words with count: [('cantaloupe', 378), ('subset', 204), ('tumbler', 119), ('mixer', 88), ('acknowledgment', 84)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.0 | 0.09 | 0.315 | 0.375 | 0.43 | 0.445 | 0.405 | 0.445 | 0.45 |
| GTF | recall | 0.0 | 0.0 | 0.08 | 0.31 | 0.4 | 0.425 | 0.4 | 0.43 | 0.44 | 0.415 |
| XTU | recall | 0.0 | 0.0 | 0.23 | 0.485 | 0.715 | 0.74 | 0.785 | 0.755 | 0.72 | 0.745 |
| XTF | recall | 0.0 | 0.0 | 0.235 | 0.55 | 0.805 | 0.91 | 0.855 | 0.82 | 0.845 | 0.83 |
| TrieHH |recall|  0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| PEM |  F1  |0.0|0.0|0.104|0.32|0.472|0.544|0.575|0.562|0.613|0.609|
| GTF |  F1  |0.0|0.0|0.054|0.307|0.419|0.517|0.547|0.584|0.596|0.579|
| XTU |  F1  |0.0|0.0|0.24|0.52|0.745|0.755|0.765|0.755|0.73|0.75|
| XTF |  F1  |0.0|0.0|0.245|0.575|0.8|0.865|0.845|0.825|0.835|0.83|
|TrieHH|  F1 |0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.0|

### 3. No. Clients 5000
Top 5 frequent words with count: [('guitarist', 551), ('sailing', 267), ('mattock', 200), ('meadow', 138), ('invasion', 97)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.0 | 0.155 | 0.345 | 0.46 | 0.485 | 0.535 | 0.51 | 0.525 | 0.505 |
| GTF | recall | 0.0 | 0.0 | 0.125 | 0.355 | 0.41 | 0.49 | 0.535 | 0.54 | 0.51 | 0.52 |
| XTU | recall | 0.0 | 0.005 | 0.21 | 0.595 | 0.75 | 0.795 | 0.775 | 0.805 | 0.785 | 0.815 |
| XTF | recall | 0.0 | 0.005 | 0.22 | 0.61 | 0.84 | 0.885 | 0.82 | 0.86 | 0.825 | 0.86 |
| TrieHH |recall|0.0|0.0|0.0|0.0|0.0|0.0|0.0|0.04|0.13|0.19|
| PEM |  F1  |0.0|0.005|0.156|0.36|0.532|0.596|0.671|0.647|0.669|0.639|
| GTF |  F1  |0.0|0.0|0.13|0.351|0.463|0.55|0.619|0.662|0.652|0.659|
| XTU |  F1  |0.0|0.015|0.205|0.53|0.76|0.805|0.795|0.81|0.78|0.815|
| XTF |  F1  |0.0|0.0|0.205|0.585|0.84|0.885|0.805|0.875|0.825|0.86|
|TrieHH|  F1 |0.0|0.0|0.0|0.0|0.0|0.0|0.033|0.125|0.217|0.258|

### 4. No. Clients 6500
Top 5 frequent words with count: [('stockings', 696), ('system', 327), ('command', 240), ('broom', 192), ('plight', 151)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.0 | 0.19 | 0.375 | 0.455 | 0.54 | 0.545 | 0.515 | 0.535 | 0.525 |
| GTF | recall | 0.0 | 0.005 | 0.205 | 0.405 | 0.485 | 0.525 | 0.51 | 0.525 | 0.545 | 0.51 |
| XTU | recall | 0.0 | 0.0 | 0.2 | 0.585 | 0.83 | 0.815 | 0.855 | 0.84 | 0.835 | 0.9 |
| XTF | recall | 0.0 | 0.0 | 0.205 | 0.66 | 0.9 | 0.9 | 0.93 | 0.915 | 0.87 | 0.865 |
|TrieHH |recall| 0.0|0.0|0.0|0.0|0.0|0.05|0.14|0.19|0.2|0.21|
| PEM |  F1  |0.0|0.0|0.206|0.443|0.489|0.552|0.614|0.61|0.598|0.592|
| GTF |  F1  |0.0|0.005|0.171|0.39|0.475|0.536|0.56|0.575|0.585|0.562|
| XTU |  F1  |0.0|0.0|0.2|0.6|0.84|0.8|0.865|0.835|0.85|0.9|
| XTF |  F1  |0.0|0.0|0.205|0.685|0.89|0.905|0.92|0.915|0.88|0.865|
|TrieHH|  F1 |0.0|0.0|0.0|0.0|0.025|0.092|0.258|0.283|0.298|0.339|


### 5. No. Clients 8000
Top 5 frequent words with count: [('shadow', 842), ('commodity', 431), ('disruption', 322), ('vault', 208), ('farmer', 180)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.095 | 0.225 | 0.425 | 0.58 | 0.6 | 0.59 | 0.595 | 0.63 | 0.605 |
| GTF | recall | 0.0 | 0.04 | 0.225 | 0.41 | 0.555 | 0.565 | 0.585 | 0.585 | 0.605 | 0.605 |
| XTU | recall | 0.0 | 0.0 | 0.205 | 0.605 | 0.855 | 0.845 | 0.87 | 0.815 | 0.83 | 0.84 |
| XTF | recall | 0.0 | 0.0 | 0.22 | 0.645 | 0.885 | 0.905 | 0.93 | 0.935 | 0.89 | 0.92 |
|TrieHH|recall| 0.0|0.0|0.0|0.0|0.12|0.19|0.18|0.2|0.24|0.23|
| PEM |  F1  |0.0|0.065|0.215|0.381|0.537|0.627|0.665|0.727|0.735|0.728|
| GTF |  F1  |0.0|0.1|0.21|0.425|0.565|0.589|0.641|0.692|0.714|0.719|
| XTU |  F1  |0.0|0.0|0.2|0.63|0.86|0.845|0.86|0.815|0.83|0.85|
| XTF |  F1  |0.0|0.0|0.205|0.63|0.935|0.9|0.925|0.935|0.89|0.915|
|TrieHH|  F1 |0.0|0.0|0.0|0.033|0.242|0.267|0.325|0.345|0.345|0.357|


### 6. No. Clients 9500
Top 5 frequent words with count: [('lad', 1023), ('brake', 524), ('tabby', 343), ('manager', 261), ('spending', 208)]

| Method | $\varepsilon$ | 0.5 | 1.5 | 2.5 | 3.5 | 4.5 | 5.5 | 6.5 | 7.5 | 8.5 | 9.5 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| PEM | recall | 0.0 | 0.155 | 0.375 | 0.545 | 0.6 | 0.66 | 0.655 | 0.645 | 0.65 | 0.645 |
| GTF | recall | 0.0 | 0.145 | 0.355 | 0.57 | 0.635 | 0.69 | 0.665 | 0.68 | 0.655 | 0.67 |
| XTU | recall | 0.0 | 0.02 | 0.25 | 0.635 | 0.865 | 0.89 | 0.865 | 0.88 | 0.85 | 0.83 |
| XTF | recall | 0.0 | 0.05 | 0.265 | 0.645 | 0.935 | 0.915 | 0.88 | 0.885 | 0.915 | 0.92 |
|TrieHH |recall| 0.0|0.0|0.06|0.17|0.35|0.47|0.61|0.8|0.88|0.91|
| PEM |  F1  |0.0|0.195|0.405|0.555|0.617|0.661|0.677|0.653|0.669|0.658|
| GTF |  F1  |0.005|0.185|0.375|0.53|0.63|0.635|0.673|0.68|0.676|0.686|
| XTU |  F1  |0.0|0.025|0.22|0.61|0.86|0.915|0.875|0.865|0.845|0.83|
| XTF |  F1  |0.0|0.025|0.27|0.64|0.95|0.915|0.88|0.89|0.92|0.92|
|TrieHH|  F1 |0.0|0.0|0.067|0.283|0.325|0.333|0.387|0.44|0.47|0.51|


## Intra-cluster Experiments

Combine all the data from the 6 clusters and run the experiments on the combined data. 

Combined (34500 clients): 
Top 5 frequent words with count: [('lad', cluster 6), ('shadow', cluster 5), ('stockings', cluster 4), ('guitarist', cluster 3), ('brake', cluster 6)]

|Method|$\varepsilon$| 0.5| 1.5| 2.5| 3.5| 4.5| 5.5| 6.5| 7.5| 8.5| 9.5|
|----|----|----|----|----|----|----|----|----|----|----|----|
|TrieHH||F1|0.0|0.0|0.1|0.36|0.488|0.677|0.763|0.866|0.875|0.942|
|TrieHH|recall| 0.0|0.0|0.06|0.17|0.35|0.47|0.61|0.8|0.88|0.91|



